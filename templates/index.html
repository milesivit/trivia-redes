<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Trivia Redes â€” Cliente Servidor</title>
<script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

<!-- ðŸ”¹ Navbar -->
<nav class="navbar">
  <div class="nav-container">
    <span class="logo">ðŸ“¡ Trivia de Redes</span>
    <ul class="nav-links">
      <li><a href="{{ url_for('index') }}" class="active">Inicio</a></li>
      <li><a href="{{ url_for('proyecto') }}">Proyecto</a></li>
    </ul>
  </div>
</nav>

<!-- ðŸ”¹ Contenido principal -->
<main>
  <h1>Trivia de Redes (2 jugadores)</h1>

  <!-- SecciÃ³n de uniÃ³n -->
  <div id="join">
    <input id="name" placeholder="Tu nombre">
    <button onclick="join()">Unirse</button>
  </div>

  <!-- SecciÃ³n de juego -->
  <div id="game" style="display:none;">
    <h2 id="question">Esperando inicio...</h2>
    <div id="options"></div>
    <h3>Puntajes:</h3>
    <div id="players"></div>
  </div>
</main>

<!-- ðŸ”¹ Footer -->
<footer>
  <p>ðŸ’» <strong>Milena Sivit</strong> â€” 2025</p>
</footer>

<script>
const socket = io();
let myName = "";

// FunciÃ³n para unirse
function join() {
    myName = document.getElementById("name").value;
    if (!myName) return alert("IngresÃ¡ tu nombre");
    socket.emit("join", { name: myName });
    document.getElementById("join").style.display = "none";
    document.getElementById("game").style.display = "block";
}

// Mostrar pregunta y generar botones
function showQuestion(q) {
    const questionEl = document.getElementById("question");
    const optionsContainer = document.getElementById("options");

    questionEl.innerText = q.q;

    const existingImg = document.getElementById("question-img");
    if (existingImg) existingImg.remove();

    if (q.img) {
        const img = document.createElement("img");
        img.id = "question-img";
        img.src = q.img;
        img.alt = "Imagen de la pregunta";
        img.style.maxWidth = "90%";
        img.style.borderRadius = "10px";
        img.style.margin = "10px auto";
        img.style.display = "block";
        questionEl.insertAdjacentElement("afterend", img);
    }

    optionsContainer.innerHTML = "";
    q.options.forEach(option => {
        const btn = document.createElement("button");
        btn.innerText = option;
        btn.onclick = () => sendAnswer(option);
        optionsContainer.appendChild(btn);
    });
}

function sendAnswer(answer) {
    socket.emit("answer", { answer });
    document.querySelectorAll("#options button").forEach(b => b.disabled = true);
}

socket.on("player_list", (data) => {
    const container = document.getElementById("players");
    container.innerHTML = "";
    data.forEach(p => {
        const div = document.createElement("div");
        div.classList.add("player");
        div.innerHTML = `<span>${p.name}</span><span>${p.score} pts</span>`;
        container.appendChild(div);
    });
});

socket.on("start_game", (q) => { showQuestion(q); });
socket.on("next_question", (q) => { showQuestion(q); });
socket.on("game_over", (scores) => {
    let text = "ðŸ Juego terminado\n";
    scores.sort((a, b) => b.score - a.score);
    text += scores.map(p => `${p.name}: ${p.score}`).join("\n");
    alert(text);
});
</script>
</body>
</html>
